"""
Base Vulnerability Scanner
===========================

Clase base para scanners de vulnerabilidades.
"""

import logging
from typing import Dict, Any, Optional
from pathlib import Path
from repositories import ScanRepository, VulnerabilityRepository
from utils.workspace_filesystem import get_workspace_output_dir_from_scan

logger = logging.getLogger(__name__)


class BaseVulnerabilityScanner:
    """Clase base para scanners de vulnerabilidades."""
    
    def __init__(
        self,
        scan_repository: ScanRepository = None,
        vuln_repository: VulnerabilityRepository = None
    ):
        """Inicializa el scanner base."""
        self.scan_repo = scan_repository or ScanRepository()
        self.vuln_repo = vuln_repository or VulnerabilityRepository()
    
    def _get_workspace_output_dir(self, scan_id: int) -> Path:
        """
        Obtiene directorio de output del workspace para un scan.
        
        Args:
            scan_id: ID del scan
        
        Returns:
            Path al directorio de output del workspace
        """
        return get_workspace_output_dir_from_scan(scan_id, 'vuln_scans')
    
    def _create_scan(
        self,
        scan_type: str,
        target: str,
        workspace_id: int,
        user_id: int,
        tool: str,
        options: Dict[str, Any]
    ):
        """
        Crea un registro de scan en la base de datos.
        
        Args:
            scan_type: Tipo de scan
            target: Target del scan
            workspace_id: ID del workspace
            user_id: ID del usuario
            tool: Nombre de la herramienta
            options: Opciones del scan
        
        Returns:
            Scan object
        """
        options['tool'] = tool
        return self.scan_repo.create(
            scan_type=scan_type,
            target=target,
            workspace_id=workspace_id,
            user_id=user_id,
            options=options
        )


