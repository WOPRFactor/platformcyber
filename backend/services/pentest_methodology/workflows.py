"""
Workflows Data
==============

Datos de workflows detallados por metodología.
"""

from typing import Dict, Any, Optional


def get_workflow(methodology_id: str, methodology: Optional[Dict[str, Any]] = None) -> Optional[Dict[str, Any]]:
    """Obtener workflow detallado de una metodología"""
    if not methodology:
        return None
    
    workflows = {
        "black_box": {
            "name": methodology["name"],
            "description": methodology["description"],
            "workflow_phases": [
                {
                    "phase": "reconnaissance",
                    "name": "Reconocimiento",
                    "description": "Recopilación de información sobre el objetivo",
                    "estimated_time": "2-5 días",
                    "tools": ["theHarvester", "Sublist3r", "Amass", "Shodan", "Censys"],
                    "deliverables": [
                        "Lista de subdominios",
                        "Emails de empleados",
                        "Tecnologías identificadas",
                        "Servicios expuestos públicamente"
                    ]
                },
                {
                    "phase": "scanning",
                    "name": "Escaneo",
                    "description": "Identificación de servicios y puertos abiertos",
                    "estimated_time": "1-3 días",
                    "tools": ["Nmap", "Masscan", "Rustscan", "Naabu"],
                    "deliverables": [
                        "Mapa de red",
                        "Puertos abiertos",
                        "Servicios identificados",
                        "Versiones de software"
                    ]
                },
                {
                    "phase": "enumeration",
                    "name": "Enumeración",
                    "description": "Recopilación detallada de información de servicios",
                    "estimated_time": "2-4 días",
                    "tools": ["enum4linux", "smbclient", "ldapsearch", "snmpwalk"],
                    "deliverables": [
                        "Usuarios enumerados",
                        "Recursos compartidos",
                        "Configuraciones de servicios",
                        "Información de sistema"
                    ]
                },
                {
                    "phase": "vulnerability_assessment",
                    "name": "Análisis de Vulnerabilidades",
                    "description": "Identificación de vulnerabilidades en servicios",
                    "estimated_time": "3-7 días",
                    "tools": ["Nuclei", "Nikto", "WPScan", "testssl.sh"],
                    "deliverables": [
                        "Lista de vulnerabilidades",
                        "Clasificación por severidad",
                        "CVEs identificados",
                        "Vectores de ataque"
                    ]
                },
                {
                    "phase": "exploitation",
                    "name": "Explotación",
                    "description": "Aprovechamiento de vulnerabilidades identificadas",
                    "estimated_time": "3-7 días",
                    "tools": ["Metasploit", "SQLMap", "XSStrike", "Burp Suite"],
                    "deliverables": [
                        "Accesos obtenidos",
                        "Datos comprometidos",
                        "Pruebas de concepto",
                        "Evidencias de explotación"
                    ]
                },
                {
                    "phase": "post_exploitation",
                    "name": "Post-Explotación",
                    "description": "Acciones después del acceso inicial",
                    "estimated_time": "2-5 días",
                    "tools": ["LinPEAS", "WinPEAS", "Mimikatz", "BloodHound"],
                    "deliverables": [
                        "Credenciales extraídas",
                        "Datos sensibles identificados",
                        "Persistencia establecida",
                        "Movimiento lateral"
                    ]
                },
                {
                    "phase": "reporting",
                    "name": "Reporte",
                    "description": "Documentación de hallazgos y recomendaciones",
                    "estimated_time": "3-5 días",
                    "tools": ["Markdown", "LaTeX", "Jupyter Notebooks"],
                    "deliverables": [
                        "Reporte ejecutivo",
                        "Reporte técnico",
                        "Evidencias documentadas",
                        "Recomendaciones de remediación"
                    ]
                }
            ]
        },
        "gray_box": {
            "name": methodology["name"],
            "description": methodology["description"],
            "workflow_phases": [
                {
                    "phase": "reconnaissance",
                    "name": "Reconocimiento Autenticado",
                    "description": "Recopilación de información con credenciales",
                    "estimated_time": "1-3 días",
                    "tools": ["BloodHound", "PowerView", "ldapdomaindump"],
                    "deliverables": [
                        "Estructura de Active Directory",
                        "Usuarios y grupos",
                        "Políticas de seguridad",
                        "Relaciones de confianza"
                    ]
                },
                {
                    "phase": "authenticated_scanning",
                    "name": "Escaneo Autenticado",
                    "description": "Escaneo de servicios con credenciales",
                    "estimated_time": "1-2 días",
                    "tools": ["Nmap (authenticated)", "CrackMapExec", "Nessus"],
                    "deliverables": [
                        "Servicios internos",
                        "Recursos accesibles",
                        "Configuraciones de seguridad",
                        "Parches faltantes"
                    ]
                },
                {
                    "phase": "authorization_testing",
                    "name": "Pruebas de Autorización",
                    "description": "Verificación de controles de acceso",
                    "estimated_time": "2-4 días",
                    "tools": ["Burp Suite", "OWASP ZAP", "Autorize"],
                    "deliverables": [
                        "Fallas de autorización",
                        "Escalación horizontal",
                        "IDOR vulnerabilities",
                        "Bypass de controles"
                    ]
                },
                {
                    "phase": "privilege_escalation",
                    "name": "Escalación de Privilegios",
                    "description": "Obtención de privilegios elevados",
                    "estimated_time": "2-5 días",
                    "tools": ["LinPEAS", "WinPEAS", "BeRoot", "PEASS-ng"],
                    "deliverables": [
                        "Vectores de escalación",
                        "Privilegios obtenidos",
                        "Configuraciones inseguras",
                        "Credenciales adicionales"
                    ]
                },
                {
                    "phase": "lateral_movement",
                    "name": "Movimiento Lateral",
                    "description": "Propagación a través de la red",
                    "estimated_time": "2-4 días",
                    "tools": ["CrackMapExec", "Evil-WinRM", "Impacket", "Proxychains"],
                    "deliverables": [
                        "Hosts comprometidos",
                        "Rutas de movimiento",
                        "Credenciales reusadas",
                        "Dominios adicionales"
                    ]
                },
                {
                    "phase": "data_exfiltration",
                    "name": "Exfiltración de Datos",
                    "description": "Extracción de información sensible",
                    "estimated_time": "1-3 días",
                    "tools": ["curl", "scp", "PowerShell", "DNS tunneling"],
                    "deliverables": [
                        "Datos sensibles identificados",
                        "Métodos de exfiltración",
                        "Detección de DLP",
                        "Evidencias de extracción"
                    ]
                },
                {
                    "phase": "reporting",
                    "name": "Reporte",
                    "description": "Documentación completa con evidencias",
                    "estimated_time": "3-5 días",
                    "tools": ["Markdown", "LaTeX", "Jupyter Notebooks"],
                    "deliverables": [
                        "Reporte ejecutivo",
                        "Reporte técnico",
                        "Cadena de ataque documentada",
                        "Remediaciones priorizadas"
                    ]
                }
            ]
        },
        "white_box": {
            "name": methodology["name"],
            "description": methodology["description"],
            "workflow_phases": [
                {
                    "phase": "architecture_review",
                    "name": "Revisión de Arquitectura",
                    "description": "Análisis de diseño y arquitectura del sistema",
                    "estimated_time": "2-5 días",
                    "tools": ["Draw.io", "PlantUML", "Threat Dragon"],
                    "deliverables": [
                        "Diagramas de arquitectura",
                        "Flujo de datos",
                        "Modelos de amenazas",
                        "Análisis de superficie de ataque"
                    ]
                },
                {
                    "phase": "code_review",
                    "name": "Revisión de Código",
                    "description": "Análisis manual de código fuente",
                    "estimated_time": "5-10 días",
                    "tools": ["VS Code", "Sublime Text", "grep", "ripgrep"],
                    "deliverables": [
                        "Vulnerabilidades identificadas",
                        "Patrones inseguros",
                        "Lógica de negocio comprometida",
                        "Recomendaciones de código"
                    ]
                },
                {
                    "phase": "static_analysis",
                    "name": "Análisis Estático (SAST)",
                    "description": "Análisis automatizado de código fuente",
                    "estimated_time": "2-4 días",
                    "tools": ["Semgrep", "Bandit", "SonarQube", "CodeQL"],
                    "deliverables": [
                        "Vulnerabilidades detectadas",
                        "Código inseguro",
                        "Complejidad ciclomática",
                        "Métricas de calidad"
                    ]
                },
                {
                    "phase": "dependency_analysis",
                    "name": "Análisis de Dependencias",
                    "description": "Identificación de vulnerabilidades en dependencias",
                    "estimated_time": "1-2 días",
                    "tools": ["OWASP Dependency-Check", "pip-audit", "npm audit", "Snyk"],
                    "deliverables": [
                        "CVEs en dependencias",
                        "Versiones desactualizadas",
                        "Licencias problemáticas",
                        "Recomendaciones de actualización"
                    ]
                },
                {
                    "phase": "configuration_review",
                    "name": "Revisión de Configuración",
                    "description": "Análisis de archivos de configuración",
                    "estimated_time": "2-3 días",
                    "tools": ["Checkov", "kube-bench", "docker-bench-security"],
                    "deliverables": [
                        "Configuraciones inseguras",
                        "Secrets hardcodeados",
                        "Permisos incorrectos",
                        "Benchmarks de seguridad"
                    ]
                },
                {
                    "phase": "dynamic_testing",
                    "name": "Pruebas Dinámicas (DAST)",
                    "description": "Testing de aplicación en ejecución",
                    "estimated_time": "3-5 días",
                    "tools": ["OWASP ZAP", "Burp Suite", "Nuclei"],
                    "deliverables": [
                        "Vulnerabilidades en runtime",
                        "Pruebas de casos límite",
                        "Validación de inputs",
                        "Comportamiento anómalo"
                    ]
                },
                {
                    "phase": "threat_modeling",
                    "name": "Modelado de Amenazas",
                    "description": "Identificación de amenazas potenciales",
                    "estimated_time": "2-4 días",
                    "tools": ["OWASP Threat Dragon", "Microsoft Threat Modeling Tool"],
                    "deliverables": [
                        "Modelo de amenazas STRIDE",
                        "Árboles de ataque",
                        "Contramedidas propuestas",
                        "Matriz de riesgos"
                    ]
                },
                {
                    "phase": "reporting",
                    "name": "Reporte Comprehensivo",
                    "description": "Documentación técnica completa",
                    "estimated_time": "5-7 días",
                    "tools": ["Markdown", "LaTeX", "Jupyter Notebooks"],
                    "deliverables": [
                        "Reporte ejecutivo",
                        "Análisis técnico detallado",
                        "Código de ejemplo seguro",
                        "Roadmap de remediación"
                    ]
                }
            ]
        },
        "red_team": {
            "name": methodology["name"],
            "description": methodology["description"],
            "workflow_phases": [
                {
                    "phase": "reconnaissance",
                    "name": "Reconocimiento Adversario",
                    "description": "Recopilación de inteligencia como un atacante real",
                    "estimated_time": "1-2 semanas",
                    "tools": ["OSINT Framework", "Maltego", "Shodan", "theHarvester"],
                    "deliverables": [
                        "Perfil de la organización",
                        "Empleados clave identificados",
                        "Infraestructura externa",
                        "Vectores de ataque identificados"
                    ]
                },
                {
                    "phase": "weaponization",
                    "name": "Armamento",
                    "description": "Creación de payloads y herramientas de ataque",
                    "estimated_time": "3-7 días",
                    "tools": ["msfvenom", "Donut", "Veil", "Shellter"],
                    "deliverables": [
                        "Payloads personalizados",
                        "Malware ofuscado",
                        "Exploits preparados",
                        "C2 infrastructure"
                    ]
                },
                {
                    "phase": "delivery",
                    "name": "Entrega",
                    "description": "Entrega de payloads al objetivo",
                    "estimated_time": "1-2 semanas",
                    "tools": ["GoPhish", "SET", "King Phisher", "Evilginx2"],
                    "deliverables": [
                        "Campañas de phishing",
                        "Sitios maliciosos",
                        "Entrega física (USB)",
                        "Tracking de ejecución"
                    ]
                },
                {
                    "phase": "exploitation",
                    "name": "Explotación",
                    "description": "Obtención de acceso inicial",
                    "estimated_time": "1-2 semanas",
                    "tools": ["Metasploit", "Cobalt Strike", "Empire", "Covenant"],
                    "deliverables": [
                        "Beacon inicial",
                        "Persistencia establecida",
                        "Evasión de EDR",
                        "Acceso mantenido"
                    ]
                },
                {
                    "phase": "installation",
                    "name": "Instalación",
                    "description": "Establecimiento de presencia duradera",
                    "estimated_time": "3-5 días",
                    "tools": ["Impacket", "PowerShell Empire", "Metasploit"],
                    "deliverables": [
                        "Backdoors instalados",
                        "Persistencia múltiple",
                        "Bypass de controles",
                        "Cuentas comprometidas"
                    ]
                },
                {
                    "phase": "command_and_control",
                    "name": "Command & Control",
                    "description": "Mantenimiento de comunicación con sistemas comprometidos",
                    "estimated_time": "Continuo",
                    "tools": ["Cobalt Strike", "Sliver", "Mythic", "Covenant"],
                    "deliverables": [
                        "C2 infrastructure operacional",
                        "Canales de comunicación",
                        "Evasión de detección",
                        "Logs de actividad"
                    ]
                },
                {
                    "phase": "actions_on_objectives",
                    "name": "Acciones en Objetivos",
                    "description": "Cumplimiento de objetivos del engagement",
                    "estimated_time": "1-2 semanas",
                    "tools": ["BloodHound", "Mimikatz", "SharpHound", "Rubeus"],
                    "deliverables": [
                        "Objetivos alcanzados",
                        "Datos exfiltrados (simulados)",
                        "Domain Admin obtenido",
                        "Impacto demostrado"
                    ]
                },
                {
                    "phase": "reporting",
                    "name": "Reporte de Red Team",
                    "description": "Documentación de operación completa",
                    "estimated_time": "1-2 semanas",
                    "tools": ["Markdown", "LaTeX", "Jupyter Notebooks"],
                    "deliverables": [
                        "Reporte ejecutivo",
                        "Timeline de ataque",
                        "TTPs utilizadas",
                        "Recomendaciones de defensa",
                        "Gaps de detección"
                    ]
                }
            ]
        }
    }
    
    return workflows.get(methodology_id)


