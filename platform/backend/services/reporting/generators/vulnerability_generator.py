"""
Vulnerability Breakdown Generator
=================================

Generador de desglose de vulnerabilidades.
"""

from typing import Dict, Any, List
from models import Vulnerability


def generate_vulnerability_breakdown(
    vulns: List[Vulnerability]
) -> Dict[str, Any]:
    """Genera desglose detallado de vulnerabilidades."""
    breakdown = {
        'critical': [],
        'high': [],
        'medium': [],
        'low': [],
        'info': []
    }
    
    for vuln in vulns:
        vuln_data = {
            'id': vuln.id,
            'title': vuln.title,
            'cve_id': vuln.cve_id,
            'target': vuln.target,
            'port': vuln.port,
            'service': vuln.service,
            'status': vuln.status,
            'discovered_at': vuln.discovered_at.isoformat() if vuln.discovered_at else None,
            'cvss_score': vuln.cvss_score
        }
        
        if vuln.severity in breakdown:
            breakdown[vuln.severity].append(vuln_data)
    
    # Ordenar por CVSS score (descendente)
    for severity in breakdown:
        breakdown[severity].sort(
            key=lambda x: x.get('cvss_score', 0),
            reverse=True
        )
    
    return breakdown

