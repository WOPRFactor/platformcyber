import React, { useState, useEffect, useRef, useCallback } from 'react'
import { X, Activity, BarChart3, PieChart, TrendingUp, Cpu, MemoryStick, HardDrive, Shield, Search } from 'lucide-react'
import { cn } from '../lib/utils'
import { useConsole } from '../contexts/ConsoleContext'
import { useWindowManager } from '../contexts/WindowManagerContext'
import { Chart as ChartJS, ArcElement, Tooltip, Legend, CategoryScale, LinearScale, BarElement, LineElement, PointElement, Title } from 'chart.js'
import { Doughnut, Bar, Line } from 'react-chartjs-2'

// Registrar componentes de Chart.js
ChartJS.register(
  ArcElement,
  Tooltip,
  Legend,
  CategoryScale,
  LinearScale,
  BarElement,
  LineElement,
  PointElement,
  Title
)

interface ProcessGraphConsoleProps {
  isOpen: boolean
  onClose: () => void
}

const ProcessGraphConsole: React.FC<ProcessGraphConsoleProps> = ({ isOpen, onClose }) => {
  const { tasks, logs } = useConsole()
  const { getZIndex, bringToFront } = useWindowManager()
  const [activeTab, setActiveTab] = useState<'overview' | 'progress' | 'vulnerabilities' | 'discovery'>('overview')
  const windowId = 'process-graph-console'

  // Estados para drag & resize
  const [isDragging, setIsDragging] = useState(false)
  const [isResizing, setIsResizing] = useState(false)
  const [position, setPosition] = useState({ x: 100, y: 100 })
  const [size, setSize] = useState({ width: 1200, height: 700 })
  const [dragStart, setDragStart] = useState({ x: 0, y: 0 })
  const [resizeStart, setResizeStart] = useState({ x: 0, y: 0, width: 0, height: 0 })

  // Refs para acceder al DOM
  const modalRef = useRef<HTMLDivElement>(null)

  // Función para iniciar el drag
  const handleMouseDown = (e: React.MouseEvent) => {
    // Traer la ventana al frente cuando se hace click
    bringToFront(windowId)

    if (e.target === e.currentTarget || (e.target as HTMLElement).closest('.modal-header')) {
      setIsDragging(true)
      setDragStart({
        x: e.clientX - position.x,
        y: e.clientY - position.y
      })
    }
  }

  // Función para iniciar el resize
  const handleResizeMouseDown = (e: React.MouseEvent) => {
    e.stopPropagation()
    setIsResizing(true)
    setResizeStart({
      x: e.clientX,
      y: e.clientY,
      width: size.width,
      height: size.height
    })
  }

  // Función para manejar el movimiento del mouse
  const handleMouseMove = useCallback((e: MouseEvent) => {
    if (isDragging) {
      const newX = e.clientX - dragStart.x
      const newY = e.clientY - dragStart.y

      // Limites para mantener la modal dentro de la pantalla
      const maxX = window.innerWidth - size.width
      const maxY = window.innerHeight - size.height

      setPosition({
        x: Math.max(0, Math.min(newX, maxX)),
        y: Math.max(0, Math.min(newY, maxY))
      })
    }

    if (isResizing) {
      const newWidth = Math.max(800, resizeStart.width + (e.clientX - resizeStart.x))
      const newHeight = Math.max(500, resizeStart.height + (e.clientY - resizeStart.y))

      setSize({
        width: newWidth,
        height: newHeight
      })
    }
  }, [isDragging, isResizing, dragStart, resizeStart, size.width, size.height])

  // Función para terminar el drag/resize
  const handleMouseUp = useCallback(() => {
    setIsDragging(false)
    setIsResizing(false)
  }, [])

  // Efectos para agregar/remover event listeners
  useEffect(() => {
    if (isDragging || isResizing) {
      document.addEventListener('mousemove', handleMouseMove)
      document.addEventListener('mouseup', handleMouseUp)
      document.body.style.cursor = isDragging ? 'grabbing' : 'nw-resize'
      document.body.style.userSelect = 'none'
    }

    return () => {
      document.removeEventListener('mousemove', handleMouseMove)
      document.removeEventListener('mouseup', handleMouseUp)
      document.body.style.cursor = ''
      document.body.style.userSelect = ''
    }
  }, [isDragging, isResizing, handleMouseMove, handleMouseUp])

  // Función para calcular métricas reales basadas en tareas y logs
  const calculateRealMetrics = useCallback(() => {
    let openPorts = 0
    let scannedHosts = 0
    let discoveredServices = 0
    let foundUrls = 0
    let sensitiveFiles = 0
    let vulnerabilities = { critical: 0, high: 0, medium: 0, low: 0 }
    let scanProgress = 0

    // Procesar logs para extraer métricas reales
    logs.forEach(log => {
      const message = log.message.toLowerCase()
      const module = log.module.toLowerCase()

      // Contar puertos abiertos
      if ((message.includes('puerto') || message.includes('port')) &&
          (message.includes('abierto') || message.includes('open') || message.includes('listening'))) {
        openPorts++
      }

      // Contar hosts escaneados
      if (module === 'scanning' || module === 'reconnaissance') {
        if (message.includes('escaneando') || message.includes('scanning') ||
            message.includes('host') || message.includes('ip:')) {
          scannedHosts++
        }
      }

      // Contar servicios descubiertos
      if ((message.includes('servicio') || message.includes('service')) &&
          (message.includes('encontrado') || message.includes('detectado') ||
           message.includes('running') || message.includes('identified'))) {
        discoveredServices++
      }

      // Contar URLs encontradas (más amplio)
      if (message.includes('url') || message.includes('endpoint') || message.includes('ruta') ||
          message.includes('path') || message.includes('http') || message.includes('directory')) {
        if (message.includes('encontrado') || message.includes('descubierto') ||
            message.includes('found') || message.includes('discovered') ||
            message.includes('accesible') || message.includes('accessible')) {
          foundUrls++
        }
      }

      // Contar archivos sensibles
      if ((message.includes('archivo') || message.includes('file')) &&
          (message.includes('sensible') || message.includes('confidencial') ||
           message.includes('sensitive') || message.includes('secret') ||
           message.includes('password') || message.includes('config'))) {
        sensitiveFiles++
      }

      // Contar vulnerabilidades por severidad (más específico)
      if (message.includes('vulnerabilidad') || message.includes('vulnerability') ||
          message.includes('exploit') || message.includes('cve') ||
          message.includes('weak') || message.includes('insecure')) {

        if (message.includes('crítica') || message.includes('critical') || message.includes('cve-')) {
          vulnerabilities.critical++
        } else if (message.includes('alta') || message.includes('high') ||
                   message.includes('severe') || message.includes('dangerous')) {
          vulnerabilities.high++
        } else if (message.includes('media') || message.includes('medium') ||
                   message.includes('moderate') || message.includes('warning')) {
          vulnerabilities.medium++
        } else if (message.includes('baja') || message.includes('low') ||
                   message.includes('info') || message.includes('informational')) {
          vulnerabilities.low++
        } else {
          // Si no especifica severidad, asumir medium
          vulnerabilities.medium++
        }
      }
    })

    // Calcular progreso basado en tareas activas
    const activeTasks = tasks.filter(task => task.status === 'running')
    if (activeTasks.length > 0) {
      scanProgress = Math.round(activeTasks.reduce((acc, task) => acc + task.progress, 0) / activeTasks.length)
    }

    // Si no hay tareas activas, usar el progreso de las tareas completadas más recientes
    if (scanProgress === 0 && tasks.length > 0) {
      const completedTasks = tasks.filter(task => task.status === 'completed')
      if (completedTasks.length > 0) {
        scanProgress = 100 // Si hay tareas completadas, mostrar 100%
      }
    }

    return {
      openPorts: Math.max(openPorts, 0),
      vulnerabilities,
      scannedHosts: Math.max(scannedHosts, tasks.length), // Al menos 1 host por tarea
      discoveredServices: Math.max(discoveredServices, 0),
      foundUrls: Math.max(foundUrls, 0),
      sensitiveFiles: Math.max(sensitiveFiles, 0),
      scanProgress: Math.min(Math.max(scanProgress, 0), 100)
    }
  }, [tasks, logs])

  // Estado para métricas calculadas dinámicamente
  const [pentestMetrics, setPentestMetrics] = useState(calculateRealMetrics())

  // Actualizar métricas cuando cambian las tareas o logs
  useEffect(() => {
    const newMetrics = calculateRealMetrics()
    setPentestMetrics(newMetrics)
  }, [calculateRealMetrics])

  if (!isOpen) return null

  // Datos para gráfico de progreso de tareas (solo tareas activas o recientes)
  const activeTasks = tasks.filter(task =>
    task.status === 'running' ||
    (task.status === 'completed' && Date.now() - task.startTime.getTime() < 300000) // Últimas 5 minutos
  )

  const progressData = {
    labels: activeTasks.length > 0 ? activeTasks.map(task => task.name) : ['Sin tareas activas'],
    datasets: [{
      label: 'Progreso (%)',
      data: activeTasks.length > 0 ? activeTasks.map(task => task.progress) : [0],
      backgroundColor: activeTasks.map(task => {
        if (task.status === 'completed') return 'rgba(34, 197, 94, 0.8)'   // Verde completadas
        if (task.status === 'running') return 'rgba(59, 130, 246, 0.8)'    // Azul en progreso
        if (task.status === 'failed') return 'rgba(239, 68, 68, 0.8)'      // Rojo errores
        return 'rgba(156, 163, 175, 0.8)'  // Gris otros estados
      }),
      borderColor: activeTasks.map(task => {
        if (task.status === 'completed') return 'rgba(34, 197, 94, 1)'
        if (task.status === 'running') return 'rgba(59, 130, 246, 1)'
        if (task.status === 'failed') return 'rgba(239, 68, 68, 1)'
        return 'rgba(156, 163, 175, 1)'
      }),
      borderWidth: 2,
    }],
  }

  // Datos para gráfico de distribución de vulnerabilidades
  const vulnerabilityData = {
    labels: ['Críticas', 'Altas', 'Medias', 'Bajas'],
    datasets: [{
      data: [
        pentestMetrics.vulnerabilities.critical,
        pentestMetrics.vulnerabilities.high,
        pentestMetrics.vulnerabilities.medium,
        pentestMetrics.vulnerabilities.low,
      ],
      backgroundColor: [
        'rgba(239, 68, 68, 0.8)',   // Rojo para críticas
        'rgba(245, 101, 101, 0.8)', // Rojo claro para altas
        'rgba(251, 191, 36, 0.8)',  // Amarillo para medias
        'rgba(34, 197, 94, 0.8)',   // Verde para bajas
      ],
      borderColor: [
        'rgba(239, 68, 68, 1)',
        'rgba(245, 101, 101, 1)',
        'rgba(251, 191, 36, 1)',
        'rgba(34, 197, 94, 1)',
      ],
      borderWidth: 2,
    }],
  }

  // Datos para gráfico de descubrimientos
  const discoveryData = {
    labels: ['Puertos Abiertos', 'Servicios', 'URLs', 'Archivos Sensibles'],
    datasets: [{
      label: 'Descubrimientos',
      data: [
        pentestMetrics.openPorts,
        pentestMetrics.discoveredServices,
        pentestMetrics.foundUrls,
        pentestMetrics.sensitiveFiles
      ],
      backgroundColor: [
        'rgba(59, 130, 246, 0.8)',  // Azul para puertos
        'rgba(168, 85, 247, 0.8)',  // Morado para servicios
        'rgba(34, 197, 94, 0.8)',   // Verde para URLs
        'rgba(239, 68, 68, 0.8)',   // Rojo para archivos sensibles
      ],
      borderColor: [
        'rgba(59, 130, 246, 1)',
        'rgba(168, 85, 247, 1)',
        'rgba(34, 197, 94, 1)',
        'rgba(239, 68, 68, 1)',
      ],
      borderWidth: 2,
    }],
  }

  // Datos para historial de descubrimientos (última hora)
  const generateHistoryData = () => {
    const now = Date.now()
    const labels = []
    const portsHistory = []
    const vulnHistory = []
    const urlsHistory = []

    // Generar datos para los últimos 6 intervalos de 10 minutos
    for (let i = 5; i >= 0; i--) {
      const timePoint = new Date(now - i * 10 * 60 * 1000)
      labels.push(i === 0 ? 'Ahora' : `Hace ${i * 10}m`)

      // Contar eventos en ese intervalo de tiempo
      const intervalLogs = logs.filter(log =>
        log.timestamp.getTime() >= timePoint.getTime() - 10 * 60 * 1000 &&
        log.timestamp.getTime() < timePoint.getTime()
      )

      let portsInInterval = 0
      let vulnsInInterval = 0
      let urlsInInterval = 0

      intervalLogs.forEach(log => {
        const message = log.message.toLowerCase()
        if (message.includes('puerto') && message.includes('abierto')) portsInInterval++
        if (message.includes('vulnerabilidad') || message.includes('exploit')) vulnsInInterval++
        if (message.includes('url') || message.includes('endpoint')) urlsInInterval++
      })

      portsHistory.push(portsInInterval)
      vulnHistory.push(vulnsInInterval)
      urlsHistory.push(urlsInInterval)
    }

    return {
      labels,
      datasets: [
        {
          label: 'Puertos Abiertos',
          data: portsHistory,
          borderColor: 'rgba(59, 130, 246, 1)',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          tension: 0.4,
        },
        {
          label: 'Vulnerabilidades',
          data: vulnHistory,
          borderColor: 'rgba(239, 68, 68, 1)',
          backgroundColor: 'rgba(239, 68, 68, 0.1)',
          tension: 0.4,
        },
        {
          label: 'URLs Encontradas',
          data: urlsHistory,
          borderColor: 'rgba(34, 197, 94, 1)',
          backgroundColor: 'rgba(34, 197, 94, 0.1)',
          tension: 0.4,
        },
      ],
    }
  }

  const discoveryHistoryData = generateHistoryData()

  const chartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom' as const,
        labels: {
          color: '#e5e7eb',
          font: {
            size: 12,
          },
        },
      },
      tooltip: {
        backgroundColor: 'rgba(0, 0, 0, 0.8)',
        titleColor: '#e5e7eb',
        bodyColor: '#e5e7eb',
      },
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          color: '#9ca3af',
        },
        grid: {
          color: 'rgba(156, 163, 175, 0.2)',
        },
      },
      x: {
        ticks: {
          color: '#9ca3af',
        },
        grid: {
          color: 'rgba(156, 163, 175, 0.2)',
        },
      },
    },
  }

  const tabs = [
    { id: 'overview', label: 'Vista General', icon: Activity },
    { id: 'progress', label: 'Progreso', icon: BarChart3 },
    { id: 'vulnerabilities', label: 'Vulnerabilidades', icon: Shield },
    { id: 'discovery', label: 'Descubrimientos', icon: Search },
  ]

  return (
    <div className="fixed inset-0 z-50 bg-black bg-opacity-50 pointer-events-none">
      <div
        ref={modalRef}
        className="bg-gray-900 border border-green-500 rounded-lg shadow-2xl flex flex-col pointer-events-auto"
        style={{
          position: 'absolute',
          left: position.x,
          top: position.y,
          width: size.width,
          height: size.height,
          cursor: isDragging ? 'grabbing' : 'grab',
          zIndex: getZIndex(windowId)
        }}
        onMouseDown={handleMouseDown}
      >
        {/* Header - Draggable */}
        <div className="modal-header flex items-center justify-between p-4 border-b border-green-500 select-none">
          <h2 className="text-xl font-bold text-green-400 flex items-center gap-2">
            <PieChart className="w-6 h-6" />
            Consola de Gráficos
          </h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-700 rounded-md text-green-400 hover:text-green-300 transition-colors"
          >
            <X size={20} />
          </button>
        </div>

        {/* Resize Handle */}
        <div
          className="absolute bottom-0 right-0 w-4 h-4 cursor-nw-resize"
          onMouseDown={handleResizeMouseDown}
        >
          <div className="w-full h-full bg-green-500 rounded-tl opacity-50 hover:opacity-100 transition-opacity" />
        </div>

        {/* Tabs */}
        <div className="flex border-b border-green-700">
          {tabs.map((tab) => {
            const Icon = tab.icon
            return (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id as any)}
                className={cn(
                  'flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors',
                  activeTab === tab.id
                    ? 'text-green-400 border-b-2 border-green-400 bg-green-500/10'
                    : 'text-gray-400 hover:text-green-300 hover:bg-gray-800'
                )}
              >
                <Icon size={16} />
                {tab.label}
              </button>
            )
          })}
        </div>

        {/* Content */}
        <div className="flex-1 p-6 overflow-auto">
          {activeTab === 'overview' && (
            <div className="space-y-6">
              {/* Métricas principales de pentesting */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div className="bg-gray-800 p-4 rounded-lg border border-blue-500">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-400">Puertos Abiertos</p>
                      <p className="text-2xl font-bold text-blue-400">
                        {pentestMetrics.openPorts}
                      </p>
                    </div>
                    <Search className="w-8 h-8 text-blue-400" />
                  </div>
                </div>

                <div className="bg-gray-800 p-4 rounded-lg border border-red-500">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-400">Vulnerabilidades</p>
                      <p className="text-2xl font-bold text-red-400">
                        {Object.values(pentestMetrics.vulnerabilities).reduce((a, b) => a + b, 0)}
                      </p>
                    </div>
                    <Shield className="w-8 h-8 text-red-400" />
                  </div>
                </div>

                <div className="bg-gray-800 p-4 rounded-lg border border-green-500">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-400">Hosts Escaneados</p>
                      <p className="text-2xl font-bold text-green-400">
                        {pentestMetrics.scannedHosts}
                      </p>
                    </div>
                    <Activity className="w-8 h-8 text-green-400" />
                  </div>
                </div>

                <div className="bg-gray-800 p-4 rounded-lg border border-yellow-500">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-400">Progreso Global</p>
                      <p className="text-2xl font-bold text-yellow-400">
                        {pentestMetrics.scanProgress}%
                      </p>
                    </div>
                    <BarChart3 className="w-8 h-8 text-yellow-400" />
                  </div>
                </div>
              </div>

              {/* Gráfico de distribución de vulnerabilidades */}
              <div className="bg-gray-800 p-6 rounded-lg border border-red-500">
                <h3 className="text-lg font-semibold text-red-400 mb-4">Resumen de Vulnerabilidades</h3>
                <div className="h-64">
                  <Doughnut data={vulnerabilityData} options={chartOptions} />
                </div>
              </div>
            </div>
          )}

          {activeTab === 'progress' && (
            <div className="space-y-6">
              <div className="bg-gray-800 p-6 rounded-lg border border-green-500">
                <h3 className="text-lg font-semibold text-green-400 mb-4">Progreso de Tareas Activas</h3>
                <div className="h-80">
                  <Bar data={progressData} options={chartOptions} />
                </div>
              </div>

              {/* Lista de tareas con progreso */}
              <div className="bg-gray-800 p-6 rounded-lg border border-green-500">
                <h3 className="text-lg font-semibold text-green-400 mb-4">Detalle de Tareas</h3>
                <div className="space-y-4">
                  {tasks.map((task) => (
                    <div key={task.id} className="flex items-center justify-between p-3 bg-gray-700 rounded">
                      <div className="flex-1">
                        <div className="flex items-center justify-between mb-1">
                          <span className="font-medium text-green-400">{task.name}</span>
                          <span className="text-sm text-gray-400">{task.progress}%</span>
                        </div>
                        <div className="w-full bg-gray-600 rounded-full h-2">
                          <div
                            className="bg-green-500 h-2 rounded-full transition-all duration-300"
                            style={{ width: `${task.progress}%` }}
                          ></div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {activeTab === 'vulnerabilities' && (
            <div className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Gráfico de distribución de vulnerabilidades */}
                <div className="bg-gray-800 p-6 rounded-lg border border-red-500">
                  <h3 className="text-lg font-semibold text-red-400 mb-4">Distribución de Vulnerabilidades</h3>
                  <div className="h-64">
                    <Doughnut data={vulnerabilityData} options={chartOptions} />
                  </div>
                </div>

                {/* Métricas detalladas de vulnerabilidades */}
                <div className="space-y-4">
                  <div className="bg-gray-800 p-4 rounded-lg border border-red-600">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Shield className="w-6 h-6 text-red-600" />
                        <span className="text-red-400">Críticas</span>
                      </div>
                      <span className="text-xl font-bold text-red-600">{pentestMetrics.vulnerabilities.critical}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      Requieren atención inmediata
                    </div>
                  </div>

                  <div className="bg-gray-800 p-4 rounded-lg border border-red-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Shield className="w-6 h-6 text-red-500" />
                        <span className="text-red-400">Altas</span>
                      </div>
                      <span className="text-xl font-bold text-red-500">{pentestMetrics.vulnerabilities.high}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      Alto riesgo de explotación
                    </div>
                  </div>

                  <div className="bg-gray-800 p-4 rounded-lg border border-yellow-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Shield className="w-6 h-6 text-yellow-500" />
                        <span className="text-yellow-400">Medias</span>
                      </div>
                      <span className="text-xl font-bold text-yellow-500">{pentestMetrics.vulnerabilities.medium}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      Riesgo moderado
                    </div>
                  </div>

                  <div className="bg-gray-800 p-4 rounded-lg border border-green-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Shield className="w-6 h-6 text-green-500" />
                        <span className="text-green-400">Bajas</span>
                      </div>
                      <span className="text-xl font-bold text-green-500">{pentestMetrics.vulnerabilities.low}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      Riesgo mínimo
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {activeTab === 'discovery' && (
            <div className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Gráfico de barras de descubrimientos */}
                <div className="bg-gray-800 p-6 rounded-lg border border-blue-500">
                  <h3 className="text-lg font-semibold text-blue-400 mb-4">Descubrimientos del Pentesting</h3>
                  <div className="h-64">
                    <Bar data={discoveryData} options={chartOptions} />
                  </div>
                </div>

                {/* Métricas detalladas de descubrimientos */}
                <div className="space-y-4">
                  <div className="bg-gray-800 p-4 rounded-lg border border-blue-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Search className="w-6 h-6 text-blue-400" />
                        <span className="text-blue-400">Puertos Abiertos</span>
                      </div>
                      <span className="text-xl font-bold text-blue-400">{pentestMetrics.openPorts}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      TCP/UDP ports discovered
                    </div>
                  </div>

                  <div className="bg-gray-800 p-4 rounded-lg border border-purple-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Activity className="w-6 h-6 text-purple-400" />
                        <span className="text-purple-400">Servicios</span>
                      </div>
                      <span className="text-xl font-bold text-purple-400">{pentestMetrics.discoveredServices}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      HTTP, SSH, FTP, etc.
                    </div>
                  </div>

                  <div className="bg-gray-800 p-4 rounded-lg border border-green-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <BarChart3 className="w-6 h-6 text-green-400" />
                        <span className="text-green-400">URLs</span>
                      </div>
                      <span className="text-xl font-bold text-green-400">{pentestMetrics.foundUrls}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      Web pages discovered
                    </div>
                  </div>

                  <div className="bg-gray-800 p-4 rounded-lg border border-red-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Shield className="w-6 h-6 text-red-400" />
                        <span className="text-red-400">Archivos Sensibles</span>
                      </div>
                      <span className="text-xl font-bold text-red-400">{pentestMetrics.sensitiveFiles}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-400">
                      Config files, backups, etc.
                    </div>
                  </div>
                </div>
              </div>

              {/* Gráfico histórico de descubrimientos */}
              <div className="bg-gray-800 p-6 rounded-lg border border-green-500">
                <h3 className="text-lg font-semibold text-green-400 mb-4">Evolución de Descubrimientos</h3>
                <div className="h-80">
                  <Line data={discoveryHistoryData} options={chartOptions} />
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

export default ProcessGraphConsole
