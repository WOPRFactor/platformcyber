import { useState, useRef } from 'react'
import { CommandPreview } from '../../../components/CommandPreviewModal'
import { toast } from 'sonner'

export const useCommandPreview = () => {
  const [showPreview, setShowPreview] = useState(false)
  const [previewData, setPreviewData] = useState<CommandPreview | null>(null)
  const [previewToolName, setPreviewToolName] = useState('')
  const previewExecuteFnRef = useRef<(() => Promise<void>) | null>(null)

  const openPreview = (data: CommandPreview, toolName: string, executeFn: () => Promise<void>) => {
    console.log('ðŸš€ useCommandPreview.openPreview llamado:', {
      toolName,
      hasData: !!data,
      commandString: data?.command_string,
      parameters: data?.parameters
    })
    setPreviewData(data)
    setPreviewToolName(toolName)
    previewExecuteFnRef.current = executeFn
    setShowPreview(true)
    console.log('âœ… showPreview seteado a true')
  }

  const closePreview = () => {
    setShowPreview(false)
    setPreviewData(null)
    setPreviewToolName('')
    previewExecuteFnRef.current = null
  }

  const executePreview = async () => {
    if (previewExecuteFnRef.current) {
      setShowPreview(false)
      await previewExecuteFnRef.current()
    }
  }

  return {
    showPreview,
    previewData,
    previewToolName,
    openPreview,
    closePreview,
    executePreview
  }
}

