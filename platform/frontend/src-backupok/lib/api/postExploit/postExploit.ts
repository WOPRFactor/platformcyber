/**
 * Módulo de Post-Explotación
 * Maneja herramientas específicas de post-explotación según el backend implementado
 */

import { api } from '../shared/client'
import type {
  LinPEASResult,
  WinPEASResult,
  BloodHoundResult,
  MimikatzResult,
  PowerViewResult,
  SeatbeltResult,
  LaZagneResult,
  SSHPivotResult,
  ChiselResult,
  LigoloResult,
  PostExploitSession,
  LinPEASRequest,
  WinPEASRequest,
  BloodHoundRequest,
  MimikatzRequest,
  PowerViewRequest,
  SeatbeltRequest,
  LaZagneRequest,
  SSHPivotRequest,
  ChiselRequest,
  LigoloRequest,
  PostExploitResponse
} from './types'

/**
 * Ejecuta LinPEAS en el objetivo especificado
 * @param request - Parámetros para LinPEAS
 * @returns Resultado de la ejecución de LinPEAS
 */
export const runLinPEAS = async (request: LinPEASRequest): Promise<LinPEASResult> => {
  const response = await api.post<LinPEASResult>('post-exploitation/linpeas', request)
  return response.data
}

/**
 * Ejecuta WinPEAS en el objetivo especificado
 * @param request - Parámetros para WinPEAS
 * @returns Resultado de la ejecución de WinPEAS
 */
export const runWinPEAS = async (request: WinPEASRequest): Promise<WinPEASResult> => {
  const response = await api.post<WinPEASResult>('post-exploitation/winpeas', request)
  return response.data
}

/**
 * Ejecuta BloodHound para recolección de datos de dominio
 * @param request - Parámetros para BloodHound
 * @returns Resultado de la ejecución de BloodHound
 */
export const runBloodHound = async (request: BloodHoundRequest): Promise<BloodHoundResult> => {
  const response = await api.post<BloodHoundResult>('post-exploitation/bloodhound', request)
  return response.data
}

/**
 * Ejecuta Mimikatz para extracción de credenciales
 * @param request - Parámetros para Mimikatz
 * @returns Resultado de la ejecución de Mimikatz
 */
export const runMimikatz = async (request: MimikatzRequest): Promise<MimikatzResult> => {
  const response = await api.post<MimikatzResult>('post-exploitation/mimikatz', request)
  return response.data
}

/**
 * Ejecuta PowerView para enumeración de Active Directory
 * @param request - Parámetros para PowerView
 * @returns Resultado de la ejecución de PowerView
 */
export const runPowerView = async (request: PowerViewRequest): Promise<PowerViewResult> => {
  const response = await api.post<PowerViewResult>('post-exploitation/powerview', request)
  return response.data
}

/**
 * Ejecuta Seatbelt para enumeración de seguridad en Windows
 * @param request - Parámetros para Seatbelt
 * @returns Resultado de la ejecución de Seatbelt
 */
export const runSeatbelt = async (request: SeatbeltRequest): Promise<SeatbeltResult> => {
  const response = await api.post<SeatbeltResult>('post-exploitation/seatbelt', request)
  return response.data
}

/**
 * Ejecuta LaZagne para extracción de credenciales almacenadas
 * @param request - Parámetros para LaZagne
 * @returns Resultado de la ejecución de LaZagne
 */
export const runLaZagne = async (request: LaZagneRequest): Promise<LaZagneResult> => {
  const response = await api.post<LaZagneResult>('post-exploitation/lazagne', request)
  return response.data
}

/**
 * Configura pivoting SSH
 * @param request - Parámetros para SSH pivoting
 * @returns Resultado de la configuración de SSH pivoting
 */
export const runSSHPivot = async (request: SSHPivotRequest): Promise<SSHPivotResult> => {
  const response = await api.post<SSHPivotResult>('post-exploitation/ssh-pivot', request)
  return response.data
}

/**
 * Configura tunneling con Chisel
 * @param request - Parámetros para Chisel
 * @returns Resultado de la configuración de Chisel
 */
export const runChisel = async (request: ChiselRequest): Promise<ChiselResult> => {
  const response = await api.post<ChiselResult>('post-exploitation/chisel', request)
  return response.data
}

/**
 * Configura tunneling con Ligolo
 * @param request - Parámetros para Ligolo
 * @returns Resultado de la configuración de Ligolo
 */
export const runLigolo = async (request: LigoloRequest): Promise<LigoloResult> => {
  const response = await api.post<LigoloResult>('post-exploitation/ligolo', request)
  return response.data
}

/**
 * Obtiene los resultados de un scan específico
 * @param scanId - ID del scan
 * @returns Resultados del scan
 */
export const getScanResults = async (scanId: number): Promise<any> => {
  const response = await api.get(`post-exploitation/scans/${scanId}`)
  return response.data
}

/**
 * Objeto API de post-explotación actualizado
 * Contiene funciones específicas para cada herramienta
 */
export const postExploitAPI = {
  runLinPEAS,
  runWinPEAS,
  runBloodHound,
  runMimikatz,
  runPowerView,
  runSeatbelt,
  runLaZagne,
  runSSHPivot,
  runChisel,
  runLigolo,
  getScanResults
}



